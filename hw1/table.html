<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">

<head>
    <meta charset="utf-8">
    <title>CS171-HW1: Table</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <style type="text/css">

        table {
            border-collapse: collapse;
            border-spacing: 1px;
        }

        caption,td,th,tr {
            border: 1px solid darkgrey;
            padding-left:7px;
            padding-right:7px;
            padding-top:4px;
            padding-bottom:4px;
        }

        th {
            padding-left:24px;
            padding-right:24px;

            background-image: url(img/bg.gif);
            background-repeat: no-repeat;
            background-position: center right;

            cursor: pointer;
        }

        th[chosen = true] {
            background-color: cornflowerblue;
        }

        th.headerSortUp {
            background-image: url(img/asc.gif);
        }

        th.headerSortDown {
            background-image: url(img/desc.gif);
        }

        tr.row[chosen = true] {
            background-color: yellow;
        }

        tr.odd {
            background-color: lightgray;
        }

        tr.even {
            background-color: ghostwhite;
        }

        .slider-width{
            width: 500px;
            vertical-align: top;
            position: relative;
            top: -3px;
        }

        .interactive{
            width:120px;
            float: left;
        }

        .check-label{
            padding-right: 20px;
        }

        input[type="checkbox"] {
            display:none;
        }

        input[type="checkbox"] + label {
            /*color:#f2f2f2;*/
            /*font-family:Arial, sans-serif;*/
            /*font-size:14px;*/
        }

        input[type="checkbox"] + label span {
            display:inline-block;
            width:19px;
            height:19px;
            margin:-1px 4px 0 0;
            vertical-align:middle;
            background:url(img/check_radio_sheet.png) left top no-repeat;
            cursor:pointer;
        }

        input[type="checkbox"]:checked + label span {
            background:url(img/check_radio_sheet.png) -19px top no-repeat;
        }

        input[type="radio"] {
            display:none;
        }

        input[type="radio"] + label {
            /*color:#f2f2f2;*/
            /*font-family:Arial, sans-serif;*/
            /*font-size:14px;*/
        }

        input[type="radio"] + label span {
            display:inline-block;
            width:19px;
            height:19px;
            margin:-1px 4px 0 0;
            vertical-align:middle;
            background:url(img/check_radio_sheet.png) -38px top no-repeat;
            cursor:pointer;
        }

        input[type="radio"]:checked + label span {
            background:url(img/check_radio_sheet.png) -57px top no-repeat;
        }



    </style>
</head>

<body>
        <div>
        <label >
            <label class = interactive>Time update:</label>
            <label>1995 </label>
            <input class="slider-width" type="range" name="points" width = "300" min="1995" max="2012" step="1" value="0" id="slider-time" oninput=";">
            <label>2012</label>
        </label>
        </div>

        <div>
        <label class = "interactive" >Filter by: </label>
            <input class="table-chk" type="checkbox" id="c1" name="Americas" value="Americas" title="Americas"
                   onchange="console.log(this.id + this.checked)"></input>
            <label for="c1" class="check-label" ><span></span>Americas</label>
            <input class="table-chk" type="checkbox" id="c2" name="Africa" value="Africa" title="Africa"
                   onchange="console.log(this.id + this.checked)"></input>
            <label for="c2" class="check-label" ><span></span>Africa</label>
            <input class="table-chk" type="checkbox" id="c3" name="Asia" value="Asia" title="Asia"
                   onchange="console.log(this.id + this.checked)"></input>

            <label for="c3" class="check-label" ><span></span>Asia</label>
            <input class="table-chk" type="checkbox" id="c4" name="Europe" value="Europe" title="Europe"
                   onchange="console.log(this.id + this.checked)"></input>

            <label for="c4" class="check-label" ><span></span>Europe</label>
            <input class="table-chk" type="checkbox" id="c5" name="Oceania" value="Oceania" title="Oceania"
                   onchange="console.log(this.id + this.checked)"></input>

            <label for="c5" class="check-label" ><span></span>Oceania</label>
        </div>

        <div>
        <label class = "interactive" >Aggregation: </label>
            <input type="radio" id="r1" name="agg">
            <label for="r1" style="padding-right: 20px"><span></span>None</label>
            <input type="radio" id="r2" name="agg">
            <label for="r2"><span></span>By continent</label>
        </div>


        <script src="http://d3js.org/d3.v3.min.js"></script>
<script>


    // Specific cols we want in table, along with index mapping
    var dataMapping = { "name":0, "continent":1, "gdp":2, "life_expectancy":3, "population":4, "year":5 };
    var SelectedCols = Object.keys(dataMapping);
    var CenteredCols = 2;

    d3.json("data/countries_2012.json", function(error, data){

        var columns = SelectedCols;
        var sortDown = false;

        var table = d3.select("body").append("table"),
                thead = table.append("thead")
                        .attr("class", "thead");
        tbody = table.append("tbody");

        table.append("caption")
                .html("World Countries Ranking")
                .style("background-color", "black")
                .style("color", "white");

        thead.append("tr").selectAll("th")
                .data(columns)
                .enter()
                .append("th")
                .text(function(d) { return d; })
                .on("click", function(header, i) {

                    sortDown = !sortDown;                   //Toggle Sort Order

                    tbody.selectAll("tr").sort(function (a, b) {
                        if (sortDown)   return d3.ascending(a[header], b[header]);
                        else            return d3.descending(a[header], b[header]);
                    });

                    UpdateTable();                          //Reset/Update Table Accordingly

                    //Highlight Header On Selection
                    var elt = d3.select(this);
                    elt.attr( "chosen", true);
                    elt.classed( sortDown    ? "headerSortDown" : "headerSortUp", true);
                    elt.classed( !(sortDown) ? "headerSortDown" : "headerSortUp", false);

                });

        var rows = tbody.selectAll("tr.row")
                .data(data)
                .enter()
                .append("tr").attr("class", "row")
                .on( "mouseover", function() {                      //Hover ON
                    d3.select(this).attr("chosen", true);
                })
                .on( "mouseout", function(d,i) {
                    d3.select(this).attr("chosen", false);          //Hover OFF
                })
                .style( "background-color", function(d,i){          //Initialize Zebra Pattern
                    var elt = d3.select(this);
                    elt.classed( (i%2)==0 ? "odd" : "even", true);
                    elt.classed( (i%2)==1 ? "odd" : "even", false);
                });

        var cells = rows.selectAll("td")
                .data(function(row) {
                    return SelectedCols.map(function(column) {
                        return row[column];
                    });
                })
                .enter()
                .append("td")
                .text(function(d, i) {

                //Format columns based on header
                    if( i === dataMapping.gdp)              d = d3.round(d/1e9, 1) + "G";
                    if( i === dataMapping.life_expectancy)  d = d3.format(".1f")(d);
                    if( i === dataMapping.population)       d = d3.format(",")(d);
                    return d;
                })

                .style("text-align", function(d,i){

                //Format alignment based on left-most cols
                    if( i < CenteredCols )  return "center";
                    else                    return "right";
                });

        var UpdateTable = function(){
            thead.selectAll("th")                                       //Reset Header Labels
                    .attr("chosen", false)
                    .classed( "headerSortUp", false)
                    .classed( "headerSortDown", false);

            tbody.selectAll("tr.row")
                    .each( function(d,i){                               //Update Zebra Pattern
                        var elt = d3.select(this);
                        elt.classed( (i%2)==0 ? "odd" : "even", true);
                        elt.classed( (i%2)==1 ? "odd" : "even", false);
                    }
            );
        };

    });





</script>
</body>
</html>